<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>ii.nz</title>
   <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Yeseva+One&family=Noto+Sans">
   <link rel="stylesheet" href='/css/normalize.css' type="text/css"/>
   <link rel="stylesheet" href='/css/variables.css' type="text/css"/>
   <link rel="stylesheet" href='/css/main.css' type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,500&display=swap" rel="stylesheet">
   <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  </style>
</head>
<body>
        <body onload="checkDarkMode()">
    <header>
      <nav class="navbar" role="navigation">
        <div class="navbar__left">
          <a href="/" class="nav-logo">
            <img src="/assets/nav-logo.png" id="navLogo" alt="Logo">
          </a>
        </div>
        <div class="navbar__right" id="navbarRight">
          <li>   
            <div class="icon" onclick="toggleIcon()">
              <i class="fas fa-moon" id="toggleMode"></i>
            </div>
          </li>
          <a href="/team">Team</a>
          <a href="/projects">Projects</a>
          <a href="/post">Blog</a>
          <a href="/contact">Contact</a>
        </div>
      </nav>
    </header>
  
    <script>
      
      function checkDarkMode() {
        var storedMode = localStorage.getItem('darkMode');
        if (storedMode === 'enabled') {
          applyDarkMode();
        }
      }
  
      function toggleIcon() {
        var iconElement = document.getElementById('toggleMode');
     
        
        if (iconElement.classList.contains('fa-moon')) {
          applyDarkMode();
          localStorage.setItem('darkMode', 'enabled');
        } else {
          removeDarkMode();
          localStorage.setItem('darkMode', 'disabled');
        }
      }
  
      
      function applyDarkMode() {
        var iconElement = document.getElementById('toggleMode');
        var bg = document.getElementById("content");
        var header = document.getElementsByTagName('header')[0];
        var navbarRight = document.getElementById('navbarRight');
        var headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, b, label,li');
        var logoImage = document.getElementById('navLogo')
        var blogPosts = document.getElementsByClassName('post-list__item');
        var modals = document.getElementsByClassName('modal-content');


        iconElement.classList.remove('fa-moon');
        iconElement.classList.add('fa-sun');
        bg.classList.add('bg-dark');
        header.classList.add('header-dark');
        navbarRight.classList.add("navbar__right--dark");
  
        for (var i = 0; i < headings.length; i++) {
          headings[i].style.color = 'white';
        }
        for(var i = 0; i < blogPosts.length; i++){
            blogPosts[i].classList.add('blog-dark');
        }
        for(var i = 0; i < modals.length; i++){
            modals[i].classList.add('modal-dark');
        }
        logoImage.src = "\/assets\/dark-mode-logo.png";
      }
  
      
      function removeDarkMode() {
        var iconElement = document.getElementById('toggleMode');
        var bg = document.getElementById("content");
        var header = document.getElementsByTagName('header')[0];
        var navbarRight = document.getElementById('navbarRight');
        var headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, b, label,li');
        var logoImage = document.getElementById('navLogo')
        var blogPosts = document.getElementsByClassName('post-list__item');
        var modals = document.getElementsByClassName('modal-content');

        
        iconElement.classList.remove('fa-sun');
        iconElement.classList.add('fa-moon');
        bg.classList.remove('bg-dark');
        header.classList.remove('header-dark');
        navbarRight.classList.remove("navbar__right--dark");
        logoImage.src = "\/assets\/nav-logo.png";
  
        for (var i = 0; i < headings.length; i++) {
          headings[i].style.color = '';
        }
        for(var i = 0; i < blogPosts.length; i++){
            blogPosts[i].classList.remove('blog-dark');
        }
        for(var i = 0; i < modals.length; i++){
            modals[i].classList.remove('modal-dark');
        }

      }
    </script>
  </body>
  
        <main id="content">
<section class="post__entry">
  <article>
    <h1 class="post__title">Digital Ocean APIv2  in chef-provisioning</h1>
    <div class="post__info">
      <p>By
        
        <span class='post__author'>
          Hippie Hacker
        </span>
        
        ,
        <time>October 30, 2015</time>
      </p>
    </div>
    </div>
    <div class="post__content">
      <p>Digital Ocean is <a href="https://developers.digitalocean.com/documentation/changelog/api-v1/sunsetting-api-v1/">sunsetting api v1</a> on November 9th. It&rsquo;s taken a while, but @geemus <a href="https://github.com/fog/fog/issues/3419#issuecomment-149700617">released support in fog v1.35.0</a></p>
<p>I was able to take that work and <a href="https://github.com/chef/chef-provisioning-fog/issues/119#issuecomment-152188977">update chef-provisioning-fog</a> which we can now use to chef-provision on digital ocean after next week.</p>
<p>The branch is at <a href="https://github.com/ii/chef-provisioning-fog/tree/do_api_v2">ii/chef-provisioning-fog apiv2</a></p>
<p>Run <code>chef-client -z my_do_server.rb</code> on the following ruby:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>with_driver <span style="color:#4070a0">&#39;fog:DigitalOcean&#39;</span>, <span style="color:#517918">compute_options</span>: {
</span></span><span style="display:flex;"><span>                 <span style="color:#517918">digitalocean_token</span>: <span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">&#39;DOTOKEN&#39;</span><span style="color:#666">]</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#                 digitalocean_api_key: &#39;V1_DEPRECATED&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#                 digitalocean_client_id: &#39;V1_DEPRECATED&#39;,</span>
</span></span><span style="display:flex;"><span>               }
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Adding compute_options here seems broken ^^^^</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># so make sure and add driver_options to knife.rb</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># put this in knife.rb</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#knife[:digital_ocean_access_token] = ENV[&#39;DOTOKEN&#39;]</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#driver_options compute_options: {digitalocean_token: ENV[&#39;DOTOKEN&#39;]}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>with_machine_options <span style="color:#517918">bootstrap_options</span>: {
</span></span><span style="display:flex;"><span>                       <span style="color:#517918">image_distribution</span>: <span style="color:#4070a0">&#39;Ubuntu&#39;</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#517918">image_name</span>: <span style="color:#4070a0">&#39;14.04 x64&#39;</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#517918">region_name</span>: <span style="color:#4070a0">&#39;New York 3&#39;</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#517918">flavor_name</span>: <span style="color:#4070a0">&#39;2GB&#39;</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#517918">tags</span>: {
</span></span><span style="display:flex;"><span>                         <span style="color:#4070a0">&#39;ii&#39;</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">&#39;lovesyou&#39;</span>
</span></span><span style="display:flex;"><span>                       },
</span></span><span style="display:flex;"><span>                     }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>with_chef_server <span style="color:#4070a0">&#39;https://api.chef.io/organizations/ii&#39;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#517918">:client_name</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:node_name</span><span style="color:#666">]</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#517918">:signing_key_filename</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:client_key</span><span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>machine <span style="color:#4070a0">&#39;do.ii.delivery&#39;</span>
</span></span></code></pre></div>
    </div>
  </article>
  <nav class="back-nav">
  <a href="/post">← back to posts</a>
  </nav>
</section>

        </main>
        
<footer>
  <div class="footer__left">
  <b class='footer_logo'><a href="/">ii</a></b>
  </div>
  <div class='footer__right'>
  <ul class="contact-details">
 
    <li>   
      <a href="https://github.com/ii">
        <div id="github" class="icon">
            <i class="fab fa-github"></i>
        </div>
        Github
      </a>
    </li>
    <li>
      <a href="https://gitlab.com/ii">
        <div class="icon">
          <i class="fab fa-gitlab"></i>
        </div>
        Gitlab
      </a>
    </li>
    <li>
      <a href="mailto:hello@ii.nz">
        <div class="icon">
          <i class="fas fa-envelope"></i>
      </div>
      Email
      </a>
    </li>
    <li>
      <a href="https://www.linkedin.com/company/99165471/" target="_blank" rel="noopener noreferrer">
        <div class="icon">
          <i class="fab fa-linkedin"></i>
        </div>
        LinkedIn
      </a>
    </li>
    
  </ul>
</footer>
    </body>
</html>